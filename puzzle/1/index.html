<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>è·³æˆ¿å­æ¸¸æˆ</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
		<link rel="shortcut icon" href="../../build/img/azil-orange-ico.png">
		<link href="//cdn.bootcdn.net/ajax/libs/driver.js/0.9.8/driver.min.css" rel="stylesheet">
		<script src="//cdn.bootcdn.net/ajax/libs/driver.js/0.9.8/driver.min.js"></script>
	</head>
	<body>
		<main id="app" class="main">
			<div style="position: fixed; left: 50px; top: 40px;z-index: 1;">
				<h1>æ¸¸æˆè§„åˆ™ï¼š</h1>
				<h2>ç›´åˆ°æœ€ååªå‰©ä¸€é¢—é»‘è‰²æ£‹å­åˆ™è·èƒœ</h2>
				<br>
				<br>
				<h3>ç©æ³•ä»‹ç»ï¼š</h3>
				<a href="https://www.bilibili.com/video/BV1op4y1S7ZP" target="_blank">GMçš„ç§˜å¯†åŸºåœ°</a>
				<small>æ¸¸æˆä¹Ÿæ˜¯çœ‹åˆ°è§†é¢‘åšçš„ğŸ˜ƒ</small>
				<br>
				<br>
				<button type="button" class="btn btn-1" id="demo-btn"><span>æ¼” ç¤º</span></button>
				<button type="button" class="btn btn-2" onclick="startGame()"><span>é‡æ–°å¼€å§‹</span></button>
			</div>
			<div class="warp">
				<div id="game" class="game"></div>
			</div>
			<div id="time" style="position: fixed;top: 40px;right: 0px;font-size: 30px;width: 300px;"></div>
		</main>

		<script src="app.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			const $ = (el) => {
				return document.querySelector(el)
			}
			const stepId = '#game-chess-'
			const stepArr = [{
					element: `${stepId}2-1`,
					popover: {
						title: "æ­¥éª¤1",
						description: "å¼€å±€å¯ä»¥ç‚¹å¼€ä»»æ„ä¸€ä¸ªæ£‹å­"
					}
				},
				{
					element: `${stepId}4-3`,
					popover: {
						title: "æ­¥éª¤2",
						description: "ç„¶åç‚¹å‡»åŒä¸€æ¡çº¿ä¸Šçš„å¹¶ä¸”ä¸­é—´ç©ºä¸€ä¸ªä½ç½®çš„æ²¡æ‰“å¼€çš„æ£‹å­"
					}
				},
				{
					element: `${stepId}2-1`,
					popover: {
						title: "æ­¥éª¤3",
						description: "å†æ¬¡ç‚¹å‡»2-1æ£‹å­ï¼Œå°±èƒ½å¾—åˆ°2ä¸ªæ‰“å¼€çš„æ£‹å­äº†"
					}
				},
				{
					element: `${stepId}4-1`,
					popover: {
						title: "å†æ¥ä¸€æ¬¡",
						description: "ç‚¹å‡»4-1æ£‹å­"
					}
				},
				{
					element: `${stepId}4-3`,
					popover: {
						title: "æ­¥éª¤5",
						description: "ç„¶åç‚¹å‡»4-3æ£‹å­"
					}
				},
				{
					element: `#game`,
					popover: {
						title: "æ­¤æ—¶å°±æ‰“å¼€äº†3ä¸ªæ£‹å­äº†ã€‚ä½ å­¦åºŸäº†å—ï¼æ¥å§ï¼Œå±•ç¤º",
						description: `<button type="button" onclick="startGame()"><span>å¼€å§‹æ¸¸æˆ</span></button>`
					}
				}
			]
			window.driver = new Driver({
				allowClose: false, //ç¦æ­¢ç‚¹å‡»å¤–éƒ¨å…³é—­
				showButtons: false,
				keyboardControl: false,
				stageBackground: '#fff', // å¼•å¯¼å¯¹è¯çš„èƒŒæ™¯è‰²
			})
			const btn = document.querySelector("#demo-btn")
			btn.onclick = function() {
				startGame()
				driver.defineSteps(stepArr)
				driver.start()
			}

			let game
			window.startGame = function() {
				game?.reset()
				driver?.reset()
				const $time = $('#time')
				$time.innerHTML = `ç‚¹å‡»æ£‹å­å¼€å§‹è®¡æ—¶`
				game = new Game({
					el: '#game',
					timeCallback(ms) {
						$time.innerHTML = `è€—æ—¶<small>(ç§’)</small>ï¼š${ms/1000}`
					},
					stepSuccess() {
						if (driver.isActivated) {
							driver.moveNext()
						}
					},
					success({ms, steps}) {
						alert(`æ­å–œä½ å®Œæˆæ¸¸æˆ,è€—æ—¶ ${ms} æ¯«ç§’,ä¸€å…±èµ°äº† ${steps.length} æ­¥`)
						const iframeEl = document.createElement('iframe')
						iframeEl.src = "../../fireworks/index.html"
						iframeEl.setAttribute('frameborder', 0)
						document.body.appendChild(iframeEl)
					}
				})
				game.paint()
			}

			document.addEventListener('DOMContentLoaded', () => {
				startGame()
			})
		</script>
	</body>
</html>
